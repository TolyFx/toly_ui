class TreeDemo5 extends StatelessWidget {
  const TreeDemo5({super.key});

  @override
  Widget build(BuildContext context) {
    return TolyTree<_AsyncData>(
      nodes: _buildInitialData(),
      loadData: _loadChildren,
      nodeBuilder: (node) => Container(
        padding: const EdgeInsets.symmetric(vertical: 8, horizontal: 8),
        child: Row(
          children: [
            Icon(node.data.icon, size: 16, color: node.data.color),
            const SizedBox(width: 8),
            Text(node.data.name),
            if (node.isLeaf == null && node.children.isEmpty)
              const Padding(
                padding: EdgeInsets.only(left: 8),
                child: Text('(点击加载)', style: TextStyle(fontSize: 12, color: Colors.grey)),
              ),
          ],
        ),
      ),
    );
  }

  List<TreeNode<_AsyncData>> _buildInitialData() {
    return [
      TreeNode<_AsyncData>(
        id: '1',
        data: const _AsyncData(
          name: '根目录',
          icon: Icons.folder,
          color: Colors.amber,
        ),
      ),
      TreeNode<_AsyncData>(
        id: '2',
        data: const _AsyncData(
          name: '用户文档',
          icon: Icons.folder,
          color: Colors.blue,
        ),
      ),
      TreeNode<_AsyncData>(
        id: '3',
        data: const _AsyncData(
          name: '只读文件',
          icon: Icons.lock,
          color: Colors.grey,
        ),
        isLeaf: true,
      ),
    ];
  }

  Future<List<TreeNode<_AsyncData>>> _loadChildren(TreeNode<_AsyncData> node) async {
    // 模拟网络延迟
    await Future.delayed(const Duration(seconds: 2));
    
    switch (node.id) {
      case '1':
        return [
          TreeNode<_AsyncData>(
            id: '1-1',
            data: const _AsyncData(
              name: '系统文件',
              icon: Icons.folder,
              color: Colors.red,
            ),
          ),
          TreeNode<_AsyncData>(
            id: '1-2',
            data: const _AsyncData(
              name: '应用程序',
              icon: Icons.folder,
              color: Colors.green,
            ),
            children: [
              TreeNode<_AsyncData>(
                id: '1-2-1',
                data: const _AsyncData(
                  name: 'app1.exe',
                  icon: Icons.apps,
                  color: Colors.grey,
                ),
                isLeaf: true,
              ),
            ],
          ),
        ];
      case '2':
        return [
          TreeNode<_AsyncData>(
            id: '2-1',
            data: const _AsyncData(
              name: '我的文档',
              icon: Icons.description,
              color: Colors.blue,
            ),
            isLeaf: true,
          ),
          TreeNode<_AsyncData>(
            id: '2-2',
            data: const _AsyncData(
              name: '下载文件',
              icon: Icons.download,
              color: Colors.purple,
            ),
            isLeaf: true,
          ),
        ];
      case '1-1':
        return [
          TreeNode<_AsyncData>(
            id: '1-1-1',
            data: const _AsyncData(
              name: 'system32',
              icon: Icons.folder,
              color: Colors.red,
            ),
            isLeaf: true,
          ),
          TreeNode<_AsyncData>(
            id: '1-1-2',
            data: const _AsyncData(
              name: 'drivers',
              icon: Icons.folder,
              color: Colors.red,
            ),
            isLeaf: true,
          ),
        ];
      default:
        return [];
    }
  }
}

class _AsyncData {
  final String name;
  final IconData icon;
  final Color color;

  const _AsyncData({
    required this.name,
    required this.icon,
    required this.color,
  });
}