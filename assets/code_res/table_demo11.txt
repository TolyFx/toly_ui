class TableDemo11 extends StatefulWidget {
  const TableDemo11({super.key});

  @override
  State<TableDemo11> createState() => _TableDemo11State();
}

class _TableDemo11State extends State<TableDemo11> {
  late EmployeeDataSource _dataSource;

  @override
  void initState() {
    super.initState();
    _dataSource = EmployeeDataSource(employees: [
      EmployeeData(
        name: '张三',
        age: 32,
        gender: '男',
        phone: '138-0000-0001',
        email: 'zhangsan@company.com',
        department: '技术部',
        position: '高级工程师',
        salary: 25000,
      ),
      EmployeeData(
        name: '李四',
        age: 28,
        gender: '女',
        phone: '138-0000-0002',
        email: 'lisi@company.com',
        department: '设计部',
        position: 'UI设计师',
        salary: 18000,
      ),
      EmployeeData(
        name: '王五',
        age: 35,
        gender: '男',
        phone: '138-0000-0003',
        email: 'wangwu@company.com',
        department: '市场部',
        position: '市场经理',
        salary: 22000,
      ),
      EmployeeData(
        name: '赵六',
        age: 29,
        gender: '女',
        phone: '138-0000-0004',
        email: 'zhaoliu@company.com',
        department: '人事部',
        position: '人事专员',
        salary: 15000,
      ),
    ]);
  }

  @override
  Widget build(BuildContext context) {
    return Container(
      decoration: BoxDecoration(
        border: Border.all(color: const Color(0xFFF0F0F0)),
        borderRadius: BorderRadius.circular(8),
      ),
      child: SfDataGrid(
        source: _dataSource,
        rowHeight: 56,
        headerRowHeight: 48,
        gridLinesVisibility: GridLinesVisibility.both,
        headerGridLinesVisibility: GridLinesVisibility.both,
        stackedHeaderRows: [
          StackedHeaderRow(cells: [
            StackedHeaderCell(columnNames: ['name'], child: _buildHeaderCell('姓名')),
            StackedHeaderCell(columnNames: ['age', 'gender'], child: _buildHeaderCell('个人信息')),
            StackedHeaderCell(columnNames: ['phone', 'email'], child: _buildHeaderCell('联系方式')),
            StackedHeaderCell(columnNames: ['department', 'position', 'salary'], child: _buildHeaderCell('工作信息')),
          ]),
        ],
        columns: [
          GridColumn(
            columnName: 'name',
            label: _buildHeaderCell('姓名'),
          ),
          GridColumn(
            columnName: 'age',
            label: _buildHeaderCell('年龄'),
          ),
          GridColumn(
            columnName: 'gender',
            label: _buildHeaderCell('性别'),
          ),
          GridColumn(
            columnName: 'phone',
            label: _buildHeaderCell('电话'),
          ),
          GridColumn(
            columnName: 'email',
            label: _buildHeaderCell('邮箱'),
          ),
          GridColumn(
            columnName: 'department',
            label: _buildHeaderCell('部门'),
          ),
          GridColumn(
            columnName: 'position',
            label: _buildHeaderCell('职位'),
          ),
          GridColumn(
            columnName: 'salary',
            label: _buildHeaderCell('薪资'),
          ),
        ],
      ),
    );
  }

  Widget _buildHeaderCell(String text) {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 16),
      alignment: Alignment.centerLeft,
      child: Text(
        text,
        style: const TextStyle(fontWeight: FontWeight.w600, fontSize: 14),
      ),
    );
  }

  Color _getDepartmentColor(String department) {
    switch (department) {
      case '技术部':
        return Colors.blue;
      case '设计部':
        return Colors.purple;
      case '市场部':
        return Colors.orange;
      case '人事部':
        return Colors.teal;
      default:
        return Colors.grey;
    }
  }
}

class EmployeeData {
  final String name;
  final int age;
  final String gender;
  final String phone;
  final String email;
  final String department;
  final String position;
  final int salary;

  EmployeeData({
    required this.name,
    required this.age,
    required this.gender,
    required this.phone,
    required this.email,
    required this.department,
    required this.position,
    required this.salary,
  });
}

class EmployeeDataSource extends DataGridSource {
  EmployeeDataSource({required List<EmployeeData> employees}) {
    _employees = employees
        .map<DataGridRow>((e) => DataGridRow(cells: [
              DataGridCell<String>(columnName: 'name', value: e.name),
              DataGridCell<int>(columnName: 'age', value: e.age),
              DataGridCell<String>(columnName: 'gender', value: e.gender),
              DataGridCell<String>(columnName: 'phone', value: e.phone),
              DataGridCell<String>(columnName: 'email', value: e.email),
              DataGridCell<String>(columnName: 'department', value: e.department),
              DataGridCell<String>(columnName: 'position', value: e.position),
              DataGridCell<int>(columnName: 'salary', value: e.salary),
            ]))
        .toList();
  }

  List<DataGridRow> _employees = [];

  @override
  List<DataGridRow> get rows => _employees;

  @override
  DataGridRowAdapter buildRow(DataGridRow row) {
    return DataGridRowAdapter(
      cells: row.getCells().map<Widget>((cell) {
        if (cell.columnName == 'name') {
          return Container(
            padding: const EdgeInsets.symmetric(horizontal: 16),
            alignment: Alignment.centerLeft,
            child: Text(
              cell.value.toString(),
              style: const TextStyle(fontWeight: FontWeight.w500),
            ),
          );
        }
        
        if (cell.columnName == 'email') {
          return Container(
            padding: const EdgeInsets.symmetric(horizontal: 16),
            alignment: Alignment.centerLeft,
            child: Text(
              cell.value.toString(),
              style: TextStyle(color: Colors.blue[700]),
            ),
          );
        }
        
        if (cell.columnName == 'department') {
          return Container(
            padding: const EdgeInsets.symmetric(horizontal: 16),
            alignment: Alignment.centerLeft,
            child: Container(
              padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
              decoration: BoxDecoration(
                color: _getDepartmentColor(cell.value.toString()),
                borderRadius: BorderRadius.circular(4),
              ),
              child: Text(
                cell.value.toString(),
                style: const TextStyle(fontSize: 12, color: Colors.white),
              ),
            ),
          );
        }
        
        if (cell.columnName == 'salary') {
          return Container(
            padding: const EdgeInsets.symmetric(horizontal: 16),
            alignment: Alignment.centerLeft,
            child: Text(
              '¥${cell.value.toString().replaceAllMapped(
                    RegExp(r'(\d{1,3})(?=(\d{3})+(?!\d))'),
                    (m) => '${m[1]},',
                  )}',
              style: const TextStyle(
                fontWeight: FontWeight.w600,
                color: Colors.green,
              ),
            ),
          );
        }

        return Container(
          padding: const EdgeInsets.symmetric(horizontal: 16),
          alignment: Alignment.centerLeft,
          child: Text(cell.value.toString()),
        );
      }).toList(),
    );
  }

  Color _getDepartmentColor(String department) {
    switch (department) {
      case '技术部':
        return Colors.blue;
      case '设计部':
        return Colors.purple;
      case '市场部':
        return Colors.orange;
      case '人事部':
        return Colors.teal;
      default:
        return Colors.grey;
    }
  }
}
